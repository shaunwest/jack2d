<!DOCTYPE html>
<html>
<head>
  <title>Platforming Demo</title>
  <script src="../bower-components/jquery/dist/jquery.min.js"></script>
  <script src="../js/jack2d.js"></script>
  <script src="../js/jack2d-platformer.js"></script>
  <style>
    #animation { position: absolute; }
    #debugContainer {top: 0; right: 0;}
  </style>
  <script>
    $(document).ready(function() {
      'use strict';
      var $animation = $('#animation'),
        animationContext = $animation[0].getContext('2d'),
        player = jack2d.mixin(['platformer.physicsObject', 'spriteAnimation', 'input']),
        debug = jack2d('debug');

      debug.container($('#debugContainer')[0]);

      player.
        setControlScheme({
          left: {key: 37},
          right: {key: 39}
        }).
        onInput(function(inputs) {
          if(inputs.left) {
            this.
              playSequence(2, 'left').
              setVelocityX(-150);
          } else if(inputs.right) {
            this.
              playSequence(2, 'right').
              setVelocityX(150);
          } else if(Math.abs(this.velocityX) < 40) { // TODO: is there a way this can be calculated?
            this.playSequence(0);
          }
        }).
        physics(function() {
          this.y = 100;
        }).
        loadSpriteSheet('img/player48.png').
        onAnimationFrame(function() {
          var frame = this.getCurrentFrame();
          if(frame) {
            animationContext.clearRect(0, 0, 48, 48);
            animationContext.drawImage(frame, 0, 0);
          }
        }).
        onFrame(function() {
          debug.
            print('pos', 'Pos: ' + this.x + ', ' + this.y).
            print('vel', 'Vel: ' + this.velocityX.toFixed(2) + ', ' + this.velocityY.toFixed(2));

          $animation.
            css('left', this.x).
            css('top', this.y);
        });
    });
  </script>
</head>
<body>
<div>
  <div id="debugContainer"></div>
  <canvas id="animation" width="48" height="48"></canvas>
</div>
</body>
</html>